<div class="container py-4">
  <div class="card shadow-sm product-card">
    <div class="card-header bg-white py-3 border-0">
      <div class="d-flex flex-wrap align-items-center gap-2">
        <div class="me-auto">
          <h5 class="mb-0 fw-semibold">
            <i class="bi bi-box-seam me-2"></i>Gestión de Productos
          </h5>
          <small class="text-secondary">Crea, edita y elimina productos</small>
        </div>

        <div class="input-group search-group" style="max-width: 360px;">
          <span class="input-group-text bg-light border-0"><i class="bi bi-search"></i></span>
          <input class="form-control border-0 bg-light" placeholder="Buscar por nombre…" [(ngModel)]="q" (keyup.enter)="search()">
          <button class="btn btn-outline-secondary" (click)="clear()" title="Limpiar"><i class="bi bi-x-lg"></i></button>
          <button class="btn btn-primary" (click)="search()" title="Buscar"><i class="bi bi-arrow-return-left"></i></button>
        </div>

        <button class="btn btn-success" (click)="openCreate()">
          <i class="bi bi-plus-lg me-1"></i> Nuevo
        </button>
      </div>
    </div>

    <div class="card-body pt-0">
      <div *ngIf="loading" class="alert alert-info d-flex align-items-center gap-2">
        <i class="bi bi-arrow-repeat spinner-border-sm"></i>
        Cargando…
      </div>

      <ng-container *ngIf="!loading && data as page">
        <div class="table-responsive rounded-3 border">
          <table class="table table-hover align-middle table-modern mb-0">
            <thead class="table-light sticky-top">
              <tr>
                <th class="text-nowrap">ID</th>
                <th class="text-nowrap">Nombre</th>
                <th class="text-end text-nowrap">Precio</th>
                <th class="text-end text-nowrap">Stock</th>
                <th>Descripción</th>
                <th class="text-center" style="width: 170px;">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let p of page.content">
                <td class="text-muted">#{{p.id}}</td>
                <td class="fw-medium">{{p.nameProduct}}</td>
                <td class="text-end">{{ p.priceProduct | number:'1.2-2' }}</td>
                <td class="text-end">
                  <span class="badge rounded-pill"
                        [ngClass]="{'text-bg-success': (p.stockProduct ?? 0) > 15,
                                    'text-bg-warning': (p.stockProduct ?? 0) > 0 && (p.stockProduct ?? 0) <= 15,
                                    'text-bg-danger': (p.stockProduct ?? 0) === 0}">
                    {{p.stockProduct}}
                  </span>
                </td>
                <td class="text-truncate description-col" title="{{p.descriptionProduct}}">
                  {{p.descriptionProduct}}
                </td>
                <td class="text-center">
                  <div class="btn-group btn-group-sm">
                    <button class="btn btn-outline-primary" (click)="openEdit(p)">
                      <i class="bi bi-pencil-square"></i>
                    </button>
                    <button class="btn btn-outline-danger" (click)="confirmDelete(p)">
                      <i class="bi bi-trash3"></i>
                    </button>
                  </div>
                </td>
              </tr>

              <tr *ngIf="page.content.length === 0">
                <td colspan="6">
                  <div class="empty-state text-center py-5">
                    <i class="bi bi-inboxes fs-1 text-secondary"></i>
                    <p class="mt-2 mb-0 text-secondary">Sin resultados para tu búsqueda</p>
                    <small class="text-muted">Prueba cambiando los filtros o crea un nuevo producto</small>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Paginación -->
        <div class="d-flex align-items-center justify-content-between mt-3">
          <small class="text-muted">
            Página <b>{{page.number + 1}}</b> de <b>{{page.totalPages || 1}}</b> ·
            Total <b>{{page.totalElements}}</b> registros
          </small>

          <nav *ngIf="page.totalPages > 1" aria-label="Page navigation">
            <ul class="pagination pagination-sm mb-0">
              <li class="page-item" [class.disabled]="page.number===0">
                <button class="page-link" (click)="changePage(page.number-1)" aria-label="Anterior">«</button>
              </li>
              <li class="page-item disabled">
                <span class="page-link">{{ page.number + 1 }}</span>
              </li>
              <li class="page-item" [class.disabled]="page.number >= page.totalPages - 1">
                <button class="page-link" (click)="changePage(page.number+1)" aria-label="Siguiente">»</button>
              </li>
            </ul>
          </nav>
        </div>
      </ng-container>
    </div>
  </div>
</div>
